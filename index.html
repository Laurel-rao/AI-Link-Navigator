<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI导航 - 科技感链接导航</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'apple-blue': '#0071e3',
            'apple-dark': '#1d1d1f',
          },
          fontFamily: {
            sans: ['-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'Helvetica Neue', 'Arial', 'sans-serif'],
          }
        }
      }
    }
  </script>
  <style type="text/tailwindcss">
    @layer utilities {
      .glassmorphism {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.18);
      }
      .tooltip-container-index {
        position: relative;
        display: inline-block; /* Or block, depending on context */
      }
      .tooltip-text-index {
        visibility: hidden;
        width: 250px; /* Adjust as needed */
        background-color: rgba(30, 41, 59, 0.85); /* slate-800 with opacity for glassmorphism */
        color: #e2e8f0; /* slate-200 */
        text-align: left;
        border-radius: 8px;
        padding: 10px 15px;
        position: absolute;
        z-index: 10;
        bottom: 125%; /* Position above the element */
        left: 50%;
        margin-left: -125px; /* Half of width */
        opacity: 0;
        transition: opacity 0.2s ease-in-out, visibility 0.2s ease-in-out;
        font-size: 0.8rem; /* Smaller font for tooltips */
        line-height: 1.5;
        box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        backdrop-filter: blur(5px); /* Subtle blur for tooltip background */
        -webkit-backdrop-filter: blur(5px);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }
      .tooltip-text-index::after { /* Arrow */
        content: "";
        position: absolute;
        top: 100%;
        left: 50%;
        margin-left: -7px;
        border-width: 7px;
        border-style: solid;
        border-color: rgba(30, 41, 59, 0.85) transparent transparent transparent;
      }
      .tooltip-container-index:hover .tooltip-text-index {
        visibility: visible;
        opacity: 1;
      }
    }
  </style>
</head>
<body class="bg-gradient-to-br from-slate-900 to-slate-800 min-h-screen text-white p-6 md:p-12">
  <div class="max-w-7xl mx-auto">
    <header class="mb-12 text-center">
      <div class="flex justify-end items-center mb-4 space-x-4">
        <a id="admin-link" href="admin.html" class="glassmorphism px-4 py-2 rounded-lg text-slate-200 hover:text-white hover:bg-slate-700/50 transition duration-200 flex items-center text-sm" style="display: none;">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1.5" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd" />
          </svg>
          管理后台
        </a>
        <a href="/logout" class="glassmorphism px-4 py-2 rounded-lg text-slate-200 hover:text-white hover:bg-slate-700/50 transition duration-200 flex items-center text-sm">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1.5" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M3 3a1 1 0 00-1 1v12a1 1 0 102 0V4a1 1 0 00-1-1zm10.293 9.293a1 1 0 001.414 1.414l3-3a1 1 0 000-1.414l-3-3a1 1 0 10-1.414 1.414L14.586 9H7a1 1 0 100 2h7.586l-1.293 1.293z" clip-rule="evenodd" />
          </svg>
          退出登录
        </a>
      </div>
      <h1 class="text-4xl md:text-6xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-purple-500 mb-4">AI资源导航</h1>
      <p class="text-slate-300 text-lg md:text-xl max-w-3xl mx-auto">前沿AI工具与资源的精选集合</p>
    </header>

    <main id="card-container" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-8">
      <!-- 卡片将通过JavaScript动态生成 -->
    </main>
  </div>

  <script>
    async function fetchUserInfo() {
        try {
            const response = await fetch('/api/user-info');
            if (!response.ok) {
                if (response.status === 401 || response.status === 403) { // Unauthorized or Forbidden
                    window.location.href = '/login.html?next=' + encodeURIComponent(window.location.pathname + window.location.search);
                }
                return null;
            }
            const userInfo = await response.json();
            return userInfo.success ? userInfo : null;
        } catch (error) {
            console.error("Error fetching user info:", error);
            // Potentially redirect to login if network error means user is likely not logged in
            // window.location.href = '/login.html?next=' + encodeURIComponent(window.location.pathname + window.location.search);
            return null;
        }
    }

    document.addEventListener('DOMContentLoaded', async () => {
      const userInfo = await fetchUserInfo();
      if (!userInfo) {
          // If userInfo is null (e.g. due to redirect in fetchUserInfo or error), stop further execution for this page.
          return; 
      }

      const adminLink = document.getElementById('admin-link');
      if (userInfo.role === 'admin') {
          adminLink.style.display = 'flex';
      } else {
          adminLink.style.display = 'none';
      }

      try {
        const response = await fetch('data.json?' + new Date().getTime()); 
        if (!response.ok) {
            if (response.status === 401 || response.status === 403) { 
                window.location.href = '/login.html?next=' + encodeURIComponent(window.location.pathname + window.location.search);
                return;
            }
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        const data = await response.json();
        
        if (data.groups && Array.isArray(data.groups)) {
            data.groups.sort((a, b) => (a.order || 0) - (b.order || 0));
        }

        const cardContainer = document.getElementById('card-container');
        
        data.groups.forEach(group => {
          const card = document.createElement('div');
          card.className = 'glassmorphism rounded-2xl p-6 hover:shadow-lg transition duration-300 ease-in-out transform hover:-translate-y-1';
          
          const groupHeaderDiv = document.createElement('div');
          groupHeaderDiv.className = 'mb-4 border-b border-slate-700 pb-3 flex justify-between items-start';
          
          const groupTexts = document.createElement('div');
          groupTexts.innerHTML = `
            <h2 class="text-2xl font-bold text-white">${group.title}</h2>
            <p class="text-slate-400 text-sm mt-1">${group.description || ''}</p>
          `;
          groupHeaderDiv.appendChild(groupTexts);
          card.appendChild(groupHeaderDiv);
          
          const linkList = document.createElement('ul');
          linkList.className = 'space-y-2';
          
          if (group.links && Array.isArray(group.links)) {
            group.links.sort((a, b) => (a.order || 0) - (b.order || 0));
          }

          (group.links || []).forEach(link => {
            const listItem = document.createElement('li');
            const tooltipContainer = document.createElement('div');
            tooltipContainer.className = 'tooltip-container-index'; 

            const anchor = document.createElement('a');
            anchor.href = link.url;
            anchor.target = '_blank';
            anchor.className = 'flex items-center p-2 rounded-lg hover:bg-slate-700/50 transition duration-200 group';
            
            const linkTitleSpan = document.createElement('span');
            linkTitleSpan.className = 'text-blue-400 group-hover:text-blue-300';
            linkTitleSpan.textContent = link.title;
            anchor.appendChild(linkTitleSpan);
            
            const arrowIcon = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            arrowIcon.setAttribute("class", "h-4 w-4 ml-2 text-slate-500 group-hover:text-blue-300 transition-transform duration-200 group-hover:translate-x-1");
            arrowIcon.setAttribute("viewBox", "0 0 20 20");
            arrowIcon.setAttribute("fill", "currentColor");
            arrowIcon.innerHTML = `<path fill-rule="evenodd" d="M10.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L12.586 11H5a1 1 0 110-2h7.586l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd" />`;
            anchor.appendChild(arrowIcon);

            tooltipContainer.appendChild(anchor);

            if (link.description) {
              const tooltipText = document.createElement('span');
              tooltipText.className = 'tooltip-text-index';
              tooltipText.textContent = link.description;
              tooltipContainer.appendChild(tooltipText);
            }

            listItem.appendChild(tooltipContainer);
            linkList.appendChild(listItem);
          });
          
          card.appendChild(linkList);
          cardContainer.appendChild(card);
        });
      } catch (error) {
        console.error('Error loading data:', error);
        const cardContainer = document.getElementById('card-container');
        cardContainer.innerHTML = `
          <div class="col-span-full text-center py-10">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-amber-500 mx-auto mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
            </svg>
            <h2 class="text-2xl font-bold text-amber-500 mb-2">数据加载失败</h2>
            <p class="text-slate-300">请稍后再试或联系管理员</p>
          </div>
        `;
      }
    });
  </script>
</body>
</html>